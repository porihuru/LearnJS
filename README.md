# LearnJS（text_access問題集）

ブラウザで動作する、CSVベースの4択（2〜4択可）クイズアプリです。カテゴリで絞り込み、ランダム出題またはID範囲指定で出題できます。回答結果はモーダル表示され、終了時に結果発表（印刷・メール作成）まで行えます。

## 特徴

- **静的HTML + Vanilla JS**（ビルド不要）
- **CSVから問題を読み込み**（XHRで取得。`fetch`不使用のため Edge/IEモード互換を意識）
- **カテゴリ選択**（件数表示つき）
- **出題方法**
  - ランダムにN問
  - IDを起点にN問（範囲指定）
- **選択肢は毎回ランダム表示**（ただし同一問題内では固定）
- **回答は1回のみ**（2回目以降のクリックは無効）
- **履歴保存**：Cookieに「IDごとの正解/不正解回数」を保存・集計、削除可能
- **結果発表**
  - 印刷（別ウィンドウで印刷用HTMLを生成）
  - メール（`mailto:` で本文生成。長さ制限に配慮して自動短縮あり）

## 使い方（起動）

このリポジトリは静的ファイルのみで構成されています。

1. `index.html` をブラウザで開きます
2. 初回起動時にCSVを読み込み、カテゴリが作成されます
3. カテゴリを選び、以下のいずれかで開始します
   - **ランダムスタート**：`N問` を指定して開始
   - **IDからスタート**：開始IDと`N問`を指定して開始

※CSVをXHRで読み込むため、ブラウザ設定によっては `file://` 直開きだと読み込みが制限される場合があります。その場合は簡易サーバ（例：VS Code Live Server等）で `http://` 経由で開いてください。

## データ形式（CSV）

デフォルトでは次のCSVを読み込みます。

- `questions_fallback.csv`（本番想定の大きなデータ）
- `questions_sample.csv`（小さなサンプル）

列は `js/state.js` の `State.CONFIG.columns` で定義されています。

- `ID`（または `QID`）
- `Category`
- `Question`
- `Choice1`（**正解扱い**）
- `Choice2`
- `Choice3`
- `Choice4`
- `Explanation`（解説。回答結果モーダルに表示）

### 選択肢数

`Choice2〜Choice4` が空の場合は自動的に表示しないため、**2択/3択/4択**に対応します（実装は `js/engine.js`）。

## 画面・機能概要

- 上部：カテゴリ選択、開始方法（ランダム / ID指定）、履歴削除
- 出題：問題文、選択肢（ランダム表示）、メタ情報（ID/カテゴリ/状態/累積）
- 回答後：モーダルで正誤、正解、解説、累積などを表示し「次へ/終了」
- 結果発表：総数/正解数/正答率と明細を表示し「印刷/メール/閉じる」
- ログ：操作ログを時系列で表示

## ディレクトリ構成

- `index.html`：画面UI（ツールバー、出題、ログ、モーダル）
- `style.css`：スタイル
- `js/`
  - `util.js`：DOM/日付/エスケープ/Cookie等ユーティリティ
  - `state.js`：設定、アプリ状態、ログ、バージョン集計
  - `csv_loader.js`：XHRでCSV取得、簡易CSVパーサ
  - `engine.js`：出題ロジック（カテゴリ集計、出題/次へ、選択肢生成など）
  - `render.js`：画面描画（カテゴリ、問題、ログ、フッター、モーダル等）
  - `history_store.js`：Cookieに履歴保存/集計
  - `print.js`：印刷用HTML生成
  - `mail.js`：`mailto:` 用本文生成
  - `app.js`：起動、UIイベント、全体制御

## 注意事項

- 本アプリはブラウザのCookieに履歴を保存します（キー：`quiz_hist`）。共有端末では取り扱いに注意してください。
- メール機能は `mailto:` を利用します。環境によっては既定のメールアプリが未設定だと動作しません。

## PR（Pull Request）とは？（簡単な説明）

PR（Pull Request）は、GitHub上で**変更内容をレビューしてから取り込むための提案**です。

- ふつうは `main` とは別のブランチで変更を作り、PRを作成します
- PR上で差分（diff）が見えるので、第三者レビューや自分のセルフチェックがしやすくなります
- CI（自動テスト）や承認フローがある場合も、PRを起点に動きます

今回は「直接コミット」の指定のためPRは作っていませんが、チーム開発ではPR運用にしておくと安全です。